(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-00e773d4"],{"6aaf":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e._self._c;return t("div",[t("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[t("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[e._v("首页")]),t("el-breadcrumb-item",[e._v("GeoServer")]),t("el-breadcrumb-item",[e._v("WFS")]),t("el-breadcrumb-item",[e._v("WFS综合操作")])],1),t("el-card",[t("button",{attrs:{id:"insert"},on:{click:e.insertClick}},[e._v("添加")]),t("button",{attrs:{id:"update"},on:{click:e.updateClick}},[e._v("修改")]),t("button",{attrs:{id:"delete"},on:{click:e.deleteClick}},[e._v("删除")]),t("button",{attrs:{id:"end"},on:{click:e.endClick}},[e._v("结束操作")]),t("div",{attrs:{id:"map"}})])],1)},n=[],i=r("c7eb"),s=r("1da1"),o=(r("a15b"),r("b0c0"),r("43df")),c=r("332e"),l=(r("d1cc"),r("e671")),d=r("02df"),u=r("169c"),v=r("14c4"),f=r("108b"),p=r("7269"),w=r("8d5e"),m=r("3e31"),g=r("29ae"),h=r("3110"),b=r("715e"),y=r("92cf"),A={data:function(){return{geoserverData:{wsName:"webgistest",uri:"http://www.openplans.org/webgistest",wfsURL:"http://localhost:28081/geoserver/wfs?",layer:"port"},select:null,edit:null,draw:null}},created:function(){},mounted:function(){this.initMap()},methods:{initMap:function(){var e=this,t=new d["a"]({format:new u["a"],url:function(t){return e.geoserverData.wfsURL+"service=WFS&version=1.1.0&request=GetFeature&typeName="+e.geoserverData.wsName+":"+e.geoserverData.layer+"&outputFormat=application/json&srsname=EPSG:3857&bbox="+t.join(",")+",EPSG:3857"},strategy:b["a"].bbox}),r=new l["a"]({title:"add Layer",source:t}),a=[Object(y["d"])("vec_w"),Object(y["d"])("cva_w"),r],n=new o["a"]({target:"map",layers:a,view:new c["a"]({projection:"EPSG:3857",center:[12233037.3,4861921.87],zoom:4})});n.on("pointermove",(function(e){n.hasFeatureAtPixel(e.pixel)?n.getTargetElement().style.cursor="pointer":n.getTargetElement().style.cursor="default"}));var i=new p["a"]({layers:[r],style:new m["a"]({image:new g["a"]({radius:8,fill:new h["a"]({color:"#f00"})})})}),s=new w["a"]({features:i.getFeatures()}),v=new f["a"]({source:new d["a"]({features:[]}),type:"Point",freehand:!1,stopClick:!0});n.addInteraction(i),n.addInteraction(s),n.addInteraction(v),s.setActive(!1),v.setActive(!1),i.setActive(!1),v.on("drawend",(function(t){var r=t.feature;e.sendWFS(r,"insert")})),i.on("select",(function(t){var r=t.selected;if(r.length>0){var a=r[0];s.getActive()||e.sendWFS(a,"delete")}})),s.on("modifyend",(function(t){var r=t.features,a=r.item(0);e.sendWFS(a,"update")})),this.select=i,this.edit=s,this.draw=v},insertClick:function(){this.select.setActive(!1),this.edit.setActive(!1),this.draw.setActive(!0)},updateClick:function(){this.draw.setActive(!1),this.edit.setActive(!0),this.select.setActive(!0)},deleteClick:function(){this.draw.setActive(!1),this.edit.setActive(!1),this.select.setActive(!0)},endClick:function(){this.draw.setActive(!1),this.select.setActive(!1),this.edit.setActive(!1)},sendWFS:function(e,t){var r=this;return Object(s["a"])(Object(i["a"])().mark((function a(){var n,s,o,c,l,d,u,f,p,w,m,g,h,b;return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.clone(),s=e.getId(),o=n.getProperties(),l=new v["a"],d=r.geoserverData,u={featureNS:d.uri,featurePrefix:d.wsName,featureType:d.layer,srsName:"EPSG:3857"},"insert"===t?(o.address="测试要素添加",o.name="添加",o.porttype="wnm添加",o.province="wnm添加",f=n.getGeometry().getCoordinates(),o.lng=f[0],o.lat=f[1],n.setProperties(o),p=n.getGeometry(),p.applyTransform((function(e,t,r){for(var a=0;a<e.length;a+=r){var n=e[a],i=e[a+1];e[a]=i,e[a+1]=n}})),n.setGeometryName("geom"),n.setGeometry(p),c=l.writeTransaction([n],null,null,u)):"update"===t?(n.setId(s),o.address="测试要素修改",o.name="修改",w=n.getGeometry().getCoordinates(),o.lng=w[0],o.lat=w[1],n.setProperties(o),n.getGeometry().applyTransform((function(e,t,r){for(var a=0;a<e.length;a+=r){var n=e[a],i=e[a+1];e[a]=i,e[a+1]=n}})),n.setGeometryName("geom"),c=l.writeTransaction(null,[n],null,u)):"delete"===t&&(n.setId(s),c=l.writeTransaction(null,null,[n],u)),m=new XMLSerializer,g=m.serializeToString(c),a.next=11,r.$http.post(r.geoserverData.wfsURL,g,{headers:{"Content-Type":"application/xml"}});case 11:h=a.sent,b=h.data,-1!==b.indexOf("Exception")?(console.log(b),alert("添加失败！"+b)):(alert("添加成功！"),window.location.reload());case 14:case"end":return a.stop()}}),a)})))()}}},k=A,S=r("2877"),j=Object(S["a"])(k,a,n,!1,null,"ee428934",null);t["default"]=j.exports},a15b:function(e,t,r){"use strict";var a=r("23e7"),n=r("e330"),i=r("44ad"),s=r("fc6a"),o=r("a640"),c=n([].join),l=i!==Object,d=l||!o("join",",");a({target:"Array",proto:!0,forced:d},{join:function(e){return c(s(this),void 0===e?",":e)}})}}]);
//# sourceMappingURL=chunk-00e773d4.c6be57b9.js.map