(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0e93f2"],{"8d5e":function(e,t,i){"use strict";var n=i("9d79"),r=i("0941"),a=i("6765"),s=i("082b"),o=i("78d6"),h=i("183c"),u=i("9f5e"),d=i("a568"),g=i("1e8d"),_=i("d60d"),l=i("8fc0"),c=i("06f8"),p=i("0af5"),m=i("e526"),f=i("d1cc"),E={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"},v=E,y=i("d1cd"),C=i("e671"),x=i("02df"),I=i("d291"),S=i("2cbd"),F=i("3e31"),T=function(e){var t;if(y["a"].call(this,{handleDownEvent:T.handleDownEvent_,handleDragEvent:T.handleDragEvent_,handleEvent:T.handleEvent,handleUpEvent:T.handleUpEvent_}),this.condition_=e.condition?e.condition:c["a"].primaryAction,this.defaultDeleteCondition_=function(e){return c["a"].altKeyOnly(e)&&c["a"].singleClick(e)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:c["a"].always,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.modified_=!1,this.rBush_=new S["a"],this.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new C["a"]({source:new x["a"]({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:T.getDefaultStyleFunction(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_,LineString:this.writeLineStringGeometry_,LinearRing:this.writeLineStringGeometry_,Polygon:this.writePolygonGeometry_,MultiPoint:this.writeMultiPointGeometry_,MultiLineString:this.writeMultiLineStringGeometry_,MultiPolygon:this.writeMultiPolygonGeometry_,Circle:this.writeCircleGeometry_,GeometryCollection:this.writeGeometryCollectionGeometry_},this.source_=null,e.source?(this.source_=e.source,t=new r["a"](this.source_.getFeatures()),g["a"].listen(this.source_,I["a"].ADDFEATURE,this.handleSourceAdd_,this),g["a"].listen(this.source_,I["a"].REMOVEFEATURE,this.handleSourceRemove_,this)):t=e.features,!t)throw new Error("The modify interaction requires features or a source");this.features_=t,this.features_.forEach(this.addFeature_,this),g["a"].listen(this.features_,a["a"].ADD,this.handleFeatureAdd_,this),g["a"].listen(this.features_,a["a"].REMOVE,this.handleFeatureRemove_,this),this.lastPointerEvent_=null};n["a"].inherits(T,y["a"]),T.MODIFY_SEGMENT_CIRCLE_CENTER_INDEX=0,T.MODIFY_SEGMENT_CIRCLE_CIRCUMFERENCE_INDEX=1,T.prototype.addFeature_=function(e){var t=e.getGeometry();t&&t.getType()in this.SEGMENT_WRITERS_&&this.SEGMENT_WRITERS_[t.getType()].call(this,e,t);var i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,i),g["a"].listen(e,l["a"].CHANGE,this.handleFeatureChange_,this)},T.prototype.willModifyFeatures_=function(e){this.modified_||(this.modified_=!0,this.dispatchEvent(new T.Event(v.MODIFYSTART,this.features_,e)))},T.prototype.removeFeature_=function(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),g["a"].unlisten(e,l["a"].CHANGE,this.handleFeatureChange_,this)},T.prototype.removeFeatureSegmentData_=function(e){var t=this.rBush_,i=[];t.forEach((function(t){e===t.feature&&i.push(t)}));for(var n=i.length-1;n>=0;--n)t.remove(i[n])},T.prototype.setActive=function(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),y["a"].prototype.setActive.call(this,e)},T.prototype.setMap=function(e){this.overlay_.setMap(e),y["a"].prototype.setMap.call(this,e)},T.prototype.handleSourceAdd_=function(e){e.feature&&this.features_.push(e.feature)},T.prototype.handleSourceRemove_=function(e){e.feature&&this.features_.remove(e.feature)},T.prototype.handleFeatureAdd_=function(e){this.addFeature_(e.element)},T.prototype.handleFeatureChange_=function(e){if(!this.changingFeature_){var t=e.target;this.removeFeature_(t),this.addFeature_(t)}},T.prototype.handleFeatureRemove_=function(e){var t=e.element;this.removeFeature_(t)},T.prototype.writePointGeometry_=function(e,t){var i=t.getCoordinates(),n={feature:e,geometry:t,segment:[i,i]};this.rBush_.insert(t.getExtent(),n)},T.prototype.writeMultiPointGeometry_=function(e,t){var i,n,r,a,s=t.getCoordinates();for(n=0,r=s.length;n<r;++n)i=s[n],a={feature:e,geometry:t,depth:[n],index:n,segment:[i,i]},this.rBush_.insert(t.getExtent(),a)},T.prototype.writeLineStringGeometry_=function(e,t){var i,n,r,a,s=t.getCoordinates();for(i=0,n=s.length-1;i<n;++i)r=s.slice(i,i+2),a={feature:e,geometry:t,index:i,segment:r},this.rBush_.insert(p["a"].boundingExtent(r),a)},T.prototype.writeMultiLineStringGeometry_=function(e,t){var i,n,r,a,s,o,h,u=t.getCoordinates();for(a=0,s=u.length;a<s;++a)for(i=u[a],n=0,r=i.length-1;n<r;++n)o=i.slice(n,n+2),h={feature:e,geometry:t,depth:[a],index:n,segment:o},this.rBush_.insert(p["a"].boundingExtent(o),h)},T.prototype.writePolygonGeometry_=function(e,t){var i,n,r,a,s,o,h,u=t.getCoordinates();for(a=0,s=u.length;a<s;++a)for(i=u[a],n=0,r=i.length-1;n<r;++n)o=i.slice(n,n+2),h={feature:e,geometry:t,depth:[a],index:n,segment:o},this.rBush_.insert(p["a"].boundingExtent(o),h)},T.prototype.writeMultiPolygonGeometry_=function(e,t){var i,n,r,a,s,o,h,u,d,g,_=t.getCoordinates();for(o=0,h=_.length;o<h;++o)for(u=_[o],a=0,s=u.length;a<s;++a)for(i=u[a],n=0,r=i.length-1;n<r;++n)d=i.slice(n,n+2),g={feature:e,geometry:t,depth:[a,o],index:n,segment:d},this.rBush_.insert(p["a"].boundingExtent(d),g)},T.prototype.writeCircleGeometry_=function(e,t){var i=t.getCenter(),n={feature:e,geometry:t,index:T.MODIFY_SEGMENT_CIRCLE_CENTER_INDEX,segment:[i,i]},r={feature:e,geometry:t,index:T.MODIFY_SEGMENT_CIRCLE_CIRCUMFERENCE_INDEX,segment:[i,i]},a=[n,r];n.featureSegments=r.featureSegments=a,this.rBush_.insert(p["a"].createOrUpdateFromCoordinate(i),n),this.rBush_.insert(t.getExtent(),r)},T.prototype.writeGeometryCollectionGeometry_=function(e,t){var i,n=t.getGeometriesArray();for(i=0;i<n.length;++i)this.SEGMENT_WRITERS_[n[i].getType()].call(this,e,n[i])},T.prototype.createOrUpdateVertexFeature_=function(e){var t=this.vertexFeature_;if(t){var i=t.getGeometry();i.setCoordinates(e)}else t=new s["a"](new f["a"](e)),this.vertexFeature_=t,this.overlay_.getSource().addFeature(t);return t},T.compareIndexes_=function(e,t){return e.index-t.index},T.handleDownEvent_=function(e){if(!this.condition_(e))return!1;this.handlePointerAtPixel_(e.pixel,e.map);var t=e.map.getCoordinateFromPixel(e.pixel);this.dragSegments_.length=0,this.modified_=!1;var i=this.vertexFeature_;if(i){var r=[],a=i.getGeometry(),s=a.getCoordinates(),o=p["a"].boundingExtent([s]),h=this.rBush_.getInExtent(o),u={};h.sort(T.compareIndexes_);for(var g=0,_=h.length;g<_;++g){var l=h[g],c=l.segment,f=n["a"].getUid(l.feature),E=l.depth;if(E&&(f+="-"+E.join("-")),u[f]||(u[f]=new Array(2)),l.geometry.getType()===m["a"].CIRCLE&&l.index===T.MODIFY_SEGMENT_CIRCLE_CIRCUMFERENCE_INDEX){var v=T.closestOnSegmentData_(t,l);d["a"].equals(v,s)&&!u[f][0]&&(this.dragSegments_.push([l,0]),u[f][0]=l)}else if(d["a"].equals(c[0],s)&&!u[f][0])this.dragSegments_.push([l,0]),u[f][0]=l;else if(d["a"].equals(c[1],s)&&!u[f][1]){if((l.geometry.getType()===m["a"].LINE_STRING||l.geometry.getType()===m["a"].MULTI_LINE_STRING)&&u[f][0]&&0===u[f][0].index)continue;this.dragSegments_.push([l,1]),u[f][1]=l}else this.insertVertexCondition_(e)&&n["a"].getUid(c)in this.vertexSegments_&&!u[f][0]&&!u[f][1]&&r.push([l,s])}r.length&&this.willModifyFeatures_(e);for(var y=r.length-1;y>=0;--y)this.insertVertex_.apply(this,r[y])}return!!this.vertexFeature_},T.handleDragEvent_=function(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e);for(var t=e.coordinate,i=0,n=this.dragSegments_.length;i<n;++i){var r,a=this.dragSegments_[i],s=a[0],o=s.depth,h=s.geometry,u=s.segment,g=a[1];while(t.length<h.getStride())t.push(u[g][t.length]);switch(h.getType()){case m["a"].POINT:r=t,u[0]=u[1]=t;break;case m["a"].MULTI_POINT:r=h.getCoordinates(),r[s.index]=t,u[0]=u[1]=t;break;case m["a"].LINE_STRING:r=h.getCoordinates(),r[s.index+g]=t,u[g]=t;break;case m["a"].MULTI_LINE_STRING:r=h.getCoordinates(),r[o[0]][s.index+g]=t,u[g]=t;break;case m["a"].POLYGON:r=h.getCoordinates(),r[o[0]][s.index+g]=t,u[g]=t;break;case m["a"].MULTI_POLYGON:r=h.getCoordinates(),r[o[1]][o[0]][s.index+g]=t,u[g]=t;break;case m["a"].CIRCLE:u[0]=u[1]=t,s.index===T.MODIFY_SEGMENT_CIRCLE_CENTER_INDEX?(this.changingFeature_=!0,h.setCenter(t),this.changingFeature_=!1):(this.changingFeature_=!0,h.setRadius(d["a"].distance(h.getCenter(),t)),this.changingFeature_=!1);break;default:}r&&this.setGeometryCoordinates_(h,r)}this.createOrUpdateVertexFeature_(t)},T.handleUpEvent_=function(e){for(var t,i,n=this.dragSegments_.length-1;n>=0;--n)if(t=this.dragSegments_[n][0],i=t.geometry,i.getType()===m["a"].CIRCLE){var r=i.getCenter(),a=t.featureSegments[0],s=t.featureSegments[1];a.segment[0]=a.segment[1]=r,s.segment[0]=s.segment[1]=r,this.rBush_.update(p["a"].createOrUpdateFromCoordinate(r),a),this.rBush_.update(i.getExtent(),s)}else this.rBush_.update(p["a"].boundingExtent(t.segment),t);return this.modified_&&(this.dispatchEvent(new T.Event(v.MODIFYEND,this.features_,e)),this.modified_=!1),!1},T.handleEvent=function(e){return!(e instanceof h["a"])||(this.lastPointerEvent_=e,e.map.getView().getInteracting()||e.type!=o["a"].POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(t=!(e.type!=o["a"].SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint()),e.type==o["a"].SINGLECLICK&&(this.ignoreNextSingleClick_=!1),y["a"].handleEvent.call(this,e)&&!t);var t},T.prototype.handlePointerMove_=function(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map)},T.prototype.handlePointerAtPixel_=function(e,t){var i=t.getCoordinateFromPixel(e),r=function(e,t){return T.pointDistanceToSegmentDataSquared_(i,e)-T.pointDistanceToSegmentDataSquared_(i,t)},a=p["a"].buffer(p["a"].createOrUpdateFromCoordinate(i),t.getView().getResolution()*this.pixelTolerance_),s=this.rBush_,o=s.getInExtent(a);if(o.length>0){o.sort(r);var h=o[0],u=h.segment,g=T.closestOnSegmentData_(i,h),_=t.getPixelFromCoordinate(g),l=d["a"].distance(e,_);if(l<=this.pixelTolerance_){var c={};if(h.geometry.getType()===m["a"].CIRCLE&&h.index===T.MODIFY_SEGMENT_CIRCLE_CIRCUMFERENCE_INDEX)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(g);else{var f,E=t.getPixelFromCoordinate(u[0]),v=t.getPixelFromCoordinate(u[1]),y=d["a"].squaredDistance(_,E),C=d["a"].squaredDistance(_,v);l=Math.sqrt(Math.min(y,C)),this.snappedToVertex_=l<=this.pixelTolerance_,this.snappedToVertex_&&(g=y>C?u[1]:u[0]),this.createOrUpdateVertexFeature_(g);for(var x=1,I=o.length;x<I;++x){if(f=o[x].segment,!(d["a"].equals(u[0],f[0])&&d["a"].equals(u[1],f[1])||d["a"].equals(u[0],f[1])&&d["a"].equals(u[1],f[0])))break;c[n["a"].getUid(f)]=!0}}return c[n["a"].getUid(u)]=!0,void(this.vertexSegments_=c)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)},T.pointDistanceToSegmentDataSquared_=function(e,t){var i=t.geometry;if(i.getType()===m["a"].CIRCLE){var n=i;if(t.index===T.MODIFY_SEGMENT_CIRCLE_CIRCUMFERENCE_INDEX){var r=d["a"].squaredDistance(n.getCenter(),e),a=Math.sqrt(r)-n.getRadius();return a*a}}return d["a"].squaredDistanceToSegment(e,t.segment)},T.closestOnSegmentData_=function(e,t){var i=t.geometry;return i.getType()===m["a"].CIRCLE&&t.index===T.MODIFY_SEGMENT_CIRCLE_CIRCUMFERENCE_INDEX?i.getClosestPoint(e):d["a"].closestOnSegment(e,t.segment)},T.prototype.insertVertex_=function(e,t){var i,n=e.segment,r=e.feature,a=e.geometry,s=e.depth,o=e.index;while(t.length<a.getStride())t.push(0);switch(a.getType()){case m["a"].MULTI_LINE_STRING:i=a.getCoordinates(),i[s[0]].splice(o+1,0,t);break;case m["a"].POLYGON:i=a.getCoordinates(),i[s[0]].splice(o+1,0,t);break;case m["a"].MULTI_POLYGON:i=a.getCoordinates(),i[s[1]][s[0]].splice(o+1,0,t);break;case m["a"].LINE_STRING:i=a.getCoordinates(),i.splice(o+1,0,t);break;default:return}this.setGeometryCoordinates_(a,i);var h=this.rBush_;h.remove(e),this.updateSegmentIndices_(a,o,s,1);var u={segment:[n[0],t],feature:r,geometry:a,depth:s,index:o};h.insert(p["a"].boundingExtent(u.segment),u),this.dragSegments_.push([u,1]);var d={segment:[t,n[1]],feature:r,geometry:a,depth:s,index:o+1};h.insert(p["a"].boundingExtent(d.segment),d),this.dragSegments_.push([d,0]),this.ignoreNextSingleClick_=!0},T.prototype.removePoint=function(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=o["a"].POINTERDRAG){var e=this.lastPointerEvent_;return this.willModifyFeatures_(e),this.removeVertex_(),this.dispatchEvent(new T.Event(v.MODIFYEND,this.features_,e)),this.modified_=!1,!0}return!1},T.prototype.removeVertex_=function(){var e,t,i,r,a,s,o,h,u,d,g,_=this.dragSegments_,l={},c=!1;for(a=_.length-1;a>=0;--a)i=_[a],d=i[0],g=n["a"].getUid(d.feature),d.depth&&(g+="-"+d.depth.join("-")),g in l||(l[g]={}),0===i[1]?(l[g].right=d,l[g].index=d.index):1==i[1]&&(l[g].left=d,l[g].index=d.index+1);for(g in l){switch(u=l[g].right,o=l[g].left,s=l[g].index,h=s-1,d=void 0!==o?o:u,h<0&&(h=0),r=d.geometry,t=r.getCoordinates(),e=t,c=!1,r.getType()){case m["a"].MULTI_LINE_STRING:t[d.depth[0]].length>2&&(t[d.depth[0]].splice(s,1),c=!0);break;case m["a"].LINE_STRING:t.length>2&&(t.splice(s,1),c=!0);break;case m["a"].MULTI_POLYGON:e=e[d.depth[1]];case m["a"].POLYGON:e=e[d.depth[0]],e.length>4&&(s==e.length-1&&(s=0),e.splice(s,1),c=!0,0===s&&(e.pop(),e.push(e[0]),h=e.length-1));break;default:}if(c){this.setGeometryCoordinates_(r,t);var f=[];if(void 0!==o&&(this.rBush_.remove(o),f.push(o.segment[0])),void 0!==u&&(this.rBush_.remove(u),f.push(u.segment[1])),void 0!==o&&void 0!==u){var E={depth:d.depth,feature:d.feature,geometry:d.geometry,index:h,segment:f};this.rBush_.insert(p["a"].boundingExtent(E.segment),E)}this.updateSegmentIndices_(r,s,d.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),_.length=0}}return c},T.prototype.setGeometryCoordinates_=function(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1},T.prototype.updateSegmentIndices_=function(e,t,i,n){this.rBush_.forEachInExtent(e.getExtent(),(function(r){r.geometry===e&&(void 0===i||void 0===r.depth||u["a"].equals(r.depth,i))&&r.index>t&&(r.index+=n)}))},T.getDefaultStyleFunction=function(){var e=F["a"].createDefaultEditing();return function(t,i){return e[m["a"].POINT]}},T.Event=function(e,t,i){_["a"].call(this,e),this.features=t,this.mapBrowserEvent=i},n["a"].inherits(T.Event,_["a"]);t["a"]=T}}]);
//# sourceMappingURL=chunk-2d0e93f2.a12eb13b.js.map