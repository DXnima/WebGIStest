(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-185dca03"],{"129f":function(e,t,n){"use strict";e.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}},"5bc03":function(e,t,n){},"61d6":function(e,t,n){"use strict";var a=n("9d79"),r=n("b49e"),i=n("92fa"),o=n("0ed9"),s={DEGREES:"degrees",IMPERIAL:"imperial",NAUTICAL:"nautical",METRIC:"metric",US:"us"},c=s,l=n("cd7e"),u=n("1e8d"),d=n("256f"),h=n("6077"),p=function(e){var t=e||{},n=void 0!==t.className?t.className:"ol-scale-line";this.innerElement_=document.createElement("DIV"),this.innerElement_.className=n+"-inner",this.element_=document.createElement("DIV"),this.element_.className=n+" "+l["a"].CLASS_UNSELECTABLE,this.element_.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=void 0!==t.minWidth?t.minWidth:64,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="";var a=t.render?t.render:p.render;o["a"].call(this,{element:this.element_,render:a,target:t.target}),u["a"].listen(this,r["a"].getChangeEventType(p.Property_.UNITS),this.handleUnitsChanged_,this),this.setUnits(t.units||c.METRIC)};a["a"].inherits(p,o["a"]),p.LEADING_DIGITS=[1,2,5],p.prototype.getUnits=function(){return this.get(p.Property_.UNITS)},p.render=function(e){var t=e.frameState;this.viewState_=t?t.viewState:null,this.updateElement_()},p.prototype.handleUnitsChanged_=function(){this.updateElement_()},p.prototype.setUnits=function(e){this.set(p.Property_.UNITS,e)},p.prototype.updateElement_=function(){var e=this.viewState_;if(e){var t=e.center,n=e.projection,a=this.getUnits(),r=a==c.DEGREES?h["a"].DEGREES:h["a"].METERS,o=d["a"].getPointResolution(n,e.resolution,t,r);a!=c.DEGREES&&(o*=n.getMetersPerUnit());var s=this.minWidth_*o,l="";if(a==c.DEGREES){var u=d["a"].METERS_PER_UNIT[h["a"].DEGREES];n.getUnits()==h["a"].DEGREES?s*=u:o/=u,s<u/60?(l="″",o*=3600):s<u?(l="′",o*=60):l="°"}else a==c.IMPERIAL?s<.9144?(l="in",o/=.0254):s<1609.344?(l="ft",o/=.3048):(l="mi",o/=1609.344):a==c.NAUTICAL?(o/=1852,l="nm"):a==c.METRIC?s<.001?(l="μm",o*=1e6):s<1?(l="mm",o*=1e3):s<1e3?l="m":(l="km",o/=1e3):a==c.US?s<.9144?(l="in",o*=39.37):s<1609.344?(l="ft",o/=.30480061):(l="mi",o/=1609.3472):i["a"].assert(!1,33);var f,m,g=3*Math.floor(Math.log(this.minWidth_*o)/Math.log(10));while(1){if(f=p.LEADING_DIGITS[(g%3+3)%3]*Math.pow(10,Math.floor(g/3)),m=Math.round(f/o),isNaN(m))return this.element_.style.display="none",void(this.renderedVisible_=!1);if(m>=this.minWidth_)break;++g}var w=f+" "+l;this.renderedHTML_!=w&&(this.innerElement_.innerHTML=w,this.renderedHTML_=w),this.renderedWidth_!=m&&(this.innerElement_.style.width=m+"px",this.renderedWidth_=m),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0)}else this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1)},p.Property_={UNITS:"units"};t["a"]=p},"732a":function(e,t,n){"use strict";n.r(t);n("b0c0");var a=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticStyle:{"max-height":"630px"},attrs:{id:"map"}}),t("el-card",[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-input",{attrs:{placeholder:"请输入内容",clearable:""},on:{clear:e.getQueryData,input:e.inputChange},model:{value:e.queryInfo.query,callback:function(t){e.$set(e.queryInfo,"query",t)},expression:"queryInfo.query"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.getFindData},slot:"append"})],1)],1),t("el-col",{attrs:{span:4}},[t("el-button",{attrs:{type:"primary"},on:{click:e.addFeatures}},[e._v("添加")]),t("el-button",{attrs:{type:"primary"},on:{click:e.removeCheck}},[e._v("批量删除")])],1)],1),null!==e.datas?t("el-pagination",{attrs:{"current-page":e.queryInfo.pageNum,"page-sizes":[5,10,15,30,100],"page-size":e.queryInfo.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}):e._e(),t("vxe-table",{ref:"xTable",staticClass:"mytable-style",attrs:{border:"",stripe:"","highlight-hover-row":"",data:e.datas,"edit-config":{trigger:"manual",mode:"row",autoClear:!1},size:"mini","row-class-name":e.rowClassName,"max-height":"350"}},[t("vxe-table-column",{attrs:{type:"checkbox",width:"40"}}),t("vxe-table-column",{attrs:{title:"操作",width:"140"},scopedSlots:e._u([{key:"default",fn:function(n){var a=n.row;return[e.$refs.xTable.isActiveByRow(a)?[t("el-tooltip",{attrs:{effect:"dark",content:"保存",placement:"bottom"}},[t("el-button",{attrs:{type:"success",size:"mini",circle:"",icon:"el-icon-s-order"},on:{click:function(t){return e.saveRowEvent(a)}}})],1),t("el-tooltip",{attrs:{effect:"dark",content:"取消",placement:"bottom"}},[t("el-button",{attrs:{type:"info",size:"mini",circle:"",icon:"el-icon-close"},on:{click:function(t){return e.cancelRowEvent(a)}}})],1),t("el-tooltip",{attrs:{effect:"dark",content:"删除",placement:"bottom"}},[t("el-button",{attrs:{type:"danger",size:"mini",circle:"",icon:"el-icon-delete-solid"},on:{click:function(t){return e.removeEvent(a)}}})],1)]:[t("el-tooltip",{attrs:{effect:"dark",content:"编辑",placement:"bottom"}},[t("el-button",{attrs:{circle:"",size:"mini",icon:"el-icon-setting"},on:{click:function(t){return e.editRowEvent(a)}}})],1)]]}}])}),e._l(e.fields,(function(n){return e.data[1]!==n.name?t("vxe-table-column",{attrs:{field:n.name,title:n.name,"min-width":"80px",height:"20px","show-header-overflow":"","show-overflow":"title","show-footer-overflow":"","edit-render":{name:"input",attrs:{type:"text"}}}}):e._e()}))],2),null===e.datas?t("el-empty",{attrs:{description:"无数据"}}):e._e()],1)],1)},r=[],i=n("c7eb"),o=n("1da1"),s=(n("d81d"),n("d3b7"),n("159b"),n("ac1f"),n("841c"),n("14d9"),n("b64b"),n("5bc03"),n("43df")),c=n("332e"),l=(n("d1cc"),n("4ca6")),u=n("e671"),d=n("8956"),h=n("02df"),p=n("169c"),f=n("108b"),m=n("7269"),g=n("8d5e"),w=n("3e31"),v=n("3493"),b=n("3110"),y=n("61d6"),E=n("29ae"),S=n("0af5"),x=(n("365c"),n("92cf"),{name:"EditFeature",data:function(){return{data:[],layerName:"",geoURL:"http://localhost:28085/",fields:[],datas:[],total:0,queryInfo:{tableName:"",geom:"",query:"",pageNum:1,pageSize:10,fields:[]},isFind:!1,isInput:!1,map:null,oldGeoJSON:"",wktLayer:null,select:null,modify:null,draw:null,drawFeature:null,isDraw:!1}},created:function(){this.layerName=this.$route.params.name,this.data[0]=this.layerName},mounted:function(){this.initMap(),this.getTableData()},methods:{initMap:function(){var e=this,t=new s["a"]({target:"map",layers:[new l["a"]({source:new d["a"],name:"OSM地图"})],view:new c["a"]({projection:"EPSG:3857",center:[12233037.3,4861921.87],zoom:5})});t.on("pointermove",(function(e){var n=t.getEventPixel(e.originalEvent),a=t.hasFeatureAtPixel(n);t.getTargetElement().style.cursor=a?"pointer":""})),t.addControl(new y["a"]);var n=new m["a"];this.select=n,t.addInteraction(n),n.on("select",(function(t){var n=t.selected,a=n[0].getProperties().info;e.oldGeoJSON=a.geoJSON;var r=e.$refs.xTable;e.addGeoJSON([a]),r.setActiveRow(a),e.editFeatures(a)})),this.map=t},getTableData:function(){var e=this;return Object(o["a"])(Object(i["a"])().mark((function t(){var n,a,r;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isFind=!1,t.next=3,e.$API.describeFeatureType(e.geoURL,e.layerName);case 3:if(n=t.sent,n){t.next=6;break}return t.abrupt("return");case 6:return e.fields=n.featureTypes[0].properties,a="",e.fields.forEach((function(t){-1!==t.type.search("gml")?e.data[1]=t.name:a=t.name})),t.next=11,e.$API.getJsonFeature(e.geoURL,e.layerName,{pageNum:e.queryInfo.pageNum,pageSize:e.queryInfo.pageSize,name:a,crs:"EPSG:3857"});case 11:if(r=t.sent,r){t.next=14;break}return t.abrupt("return");case 14:e.datas=[],r.features.forEach((function(t){t.properties.geoJSON=t.geometry,e.datas.push(t.properties)})),e.data[2]=r.features[0].geometry.type,e.total=r.totalFeatures,e.addGeoJSON(e.datas);case 19:case"end":return t.stop()}}),t)})))()},handleSizeChange:function(e){this.queryInfo.pageNum=1,this.queryInfo.pageSize=e,this.isFind?this.getFindData():this.getTableData()},handleCurrentChange:function(e){this.queryInfo.pageNum=e,this.isFind?this.getFindData():this.getTableData()},getQueryData:function(){this.queryInfo.pageNum=1,this.getTableData()},getFindData:function(){var e=this;return Object(o["a"])(Object(i["a"])().mark((function t(){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.isFind&&!e.isInput||(e.queryInfo.pageNum=1),e.isInput=!1,e.isFind=!0,e.$message.success("查询接口待完善！");case 4:case"end":return t.stop()}}),t)})))()},inputChange:function(){this.isInput=!0},addGeoJSON:function(e){var t=this.map;if(t.removeLayer(this.wktLayer),null!==e){var n=new h["a"],a=[];e.forEach((function(e){var t=(new p["a"]).readFeature(e.geoJSON);t.setProperties({info:e}),a.push(t)})),n.addFeatures(a),this.wktLayer=new u["a"]({source:n,style:this.styleFunction}),t.addLayer(this.wktLayer);var r=n.getExtent(),i=t.getView().getResolutionForExtent(r,t.getSize());e.length>1?(t.getView().setResolution(i),t.getView().setCenter(S["a"].getCenter(r))):(t.getView().setCenter(S["a"].getCenter(r)),"Point"===this.data[2]?t.getView().setZoom(11):t.getView().setResolution(i))}},editFeatures:function(e){var t=this.map,n=new g["a"]({source:this.wktLayer.getSource()});t.addInteraction(n),n.on("modifyend",(function(t){var n=t.features,a=n.array_[0];e.geoJSON=JSON.parse((new p["a"]).writeGeometry(a.getGeometry()))})),this.modify=n},addFeatures:function(){var e=this;return Object(o["a"])(Object(i["a"])().mark((function t(){var n,a,r,s;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=e,e.isDraw=!0,a=e.map,e.select.setActive(!1),r=new f["a"]({source:e.wktLayer.getSource(),type:e.data[2]}),a.addInteraction(r),s=e.$refs.xTable,r.on("drawend",function(){var e=Object(o["a"])(Object(i["a"])().mark((function e(t){var o,c;return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n.drawFeature=t.feature,e.next=3,s.insertAt({geoJSON:JSON.parse((new p["a"]).writeGeometry(t.feature.getGeometry()))},0);case 3:return o=e.sent,c=o.row,e.next=7,s.setActiveRow(c);case 7:n.editFeatures(c),a.removeInteraction(r);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 8:case"end":return t.stop()}}),t)})))()},removeCheck:function(){var e=this,t=this.$refs.xTable,n=t.getCheckboxRecords();0!==n.length?this.$confirm("此操作将永久删除数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(o["a"])(Object(i["a"])().mark((function t(){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:[],n.forEach((function(e){console.log(e)})),t.next=9;break;case 6:e.handleCurrentChange(1),t.next=10;break;case 9:e.$message.success("删除接口待完善！");case 10:case"end":return t.stop()}}),t)})))):this.$message.error("没有选中数据！")},editRowEvent:function(e){this.oldGeoJSON=e.geoJSON,this.isDraw=!1;var t=this.$refs.xTable;t.setActiveRow(e),this.addGeoJSON([e]),this.editFeatures(e)},saveRowEvent:function(e){var t=this,n=this,a=this.$refs.xTable;a.clearActived().then(Object(o["a"])(Object(i["a"])().mark((function a(){return Object(i["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n.map.removeInteraction(n.modify),n.addGeoJSON(n.datas),n.isDraw?(console.log("添加的新数据",e),t.$message.success("添加接口待完善！")):(console.log("修改后数据",e),t.$message.success("修改接口待完善！")),!t.isFind){a.next=8;break}return a.next=6,t.getFindData();case 6:a.next=10;break;case 8:return a.next=10,t.getTableData();case 10:case"end":return a.stop()}}),a)}))))},cancelRowEvent:function(e){var t=this,n=this.$refs.xTable;n.clearActived().then((function(){e.geoJSON=t.oldGeoJSON,n.revertData(e),t.map.removeInteraction(t.modify),t.addGeoJSON(t.datas)}))},removeEvent:function(e){var t=this;this.$confirm("此操作将永久删除该数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(o["a"])(Object(i["a"])().mark((function e(){return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.$message.success("删除接口待完善！");case 1:case"end":return e.stop()}}),e)}))))},styleFunction:function(e){var t=new E["a"]({radius:4,fill:new b["a"]({color:"rgb(255,0,0)"}),stroke:new v["a"]({color:"rgb(0,7,255)",width:1})}),n={Point:new w["a"]({image:t}),LineString:new w["a"]({stroke:new v["a"]({color:"rgb(255,89,0)",width:3})}),MultiLineString:new w["a"]({stroke:new v["a"]({color:"rgb(255,89,0)",width:3})}),MultiPoint:new w["a"]({image:t}),MultiPolygon:new w["a"]({stroke:new v["a"]({color:"yellow",width:1}),fill:new b["a"]({color:"rgba(255,255,0,0.29)"})}),Polygon:new w["a"]({stroke:new v["a"]({color:"blue",lineDash:[4],width:3}),fill:new b["a"]({color:"rgba(0,0,255,0.47)"})}),GeometryCollection:new w["a"]({stroke:new v["a"]({color:"rgb(208,0,255)",width:2}),fill:new b["a"]({color:"rgb(208,0,255)"}),image:new E["a"]({radius:10,fill:null,stroke:new v["a"]({color:"rgb(208,0,255)"})})}),Circle:new w["a"]({stroke:new v["a"]({color:"rgba(255,0,0,0.2)",width:2}),fill:new b["a"]({color:"rgba(255,0,0,0.2)"})})};return n[e.getGeometry().getType()]},rowClassName:function(){return"row-height"}},watch:{$route:{handler:function(e,t){this.layerName=e.params.name,this.queryInfo.pageNum=1,this.getTableData()}}}}),I=x,N=n("2877"),_=Object(N["a"])(I,a,r,!1,null,null,null);t["default"]=_.exports},"841c":function(e,t,n){"use strict";var a=n("c65b"),r=n("d784"),i=n("825a"),o=n("7234"),s=n("1d80"),c=n("129f"),l=n("577e"),u=n("dc4a"),d=n("14c3");r("search",(function(e,t,n){return[function(t){var n=s(this),r=o(t)?void 0:u(t,e);return r?a(r,t,n):new RegExp(t)[e](l(n))},function(e){var a=i(this),r=l(e),o=n(t,a,r);if(o.done)return o.value;var s=a.lastIndex;c(s,0)||(a.lastIndex=0);var u=d(a,r);return c(a.lastIndex,s)||(a.lastIndex=s),null===u?-1:u.index}]}))},8956:function(e,t,n){"use strict";var a=n("9d79"),r=n("403d"),i=function(e){var t,n=e||{};t=void 0!==n.attributions?n.attributions:[i.ATTRIBUTION];var a=void 0!==n.crossOrigin?n.crossOrigin:"anonymous",o=void 0!==n.url?n.url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png";r["a"].call(this,{attributions:t,cacheSize:n.cacheSize,crossOrigin:a,opaque:void 0===n.opaque||n.opaque,maxZoom:void 0!==n.maxZoom?n.maxZoom:19,reprojectionErrorThreshold:n.reprojectionErrorThreshold,tileLoadFunction:n.tileLoadFunction,url:o,wrapX:n.wrapX})};a["a"].inherits(i,r["a"]),i.ATTRIBUTION='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors.',t["a"]=i}}]);
//# sourceMappingURL=chunk-185dca03.4794c9fc.js.map